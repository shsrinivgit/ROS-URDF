<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="gurdy">
    <xacro:property name="m" value="0.01"/>
    <xacro:property name="r" value="0.05" />
    <xacro:property name="h" value="0.04" />
    <xacro:property name="head_ixx" value="${(m/12.0)*(3*r*r+h*h))}" />
    <xacro:property name="head_iyy" value="${head_ixx}" />
    <xacro:property name="head_izz" value="${(m*r*r)/2.0}" />

    <xacro:macro name="default_origin">
        <origin xyz="0 0 0" rpy="0 0 0"/>
    </xacro:macro>
    <xacro:macro name="upper_extra" params="mass">
 	    <inertial>
            <origin xyz="0 0 0.03" rpy="0 0 0"/>
            <mass value="${mass}" />
            <inertia ixx="2.13333333333e-07" ixy="0.0" ixz="0.0" iyy="2.13333333333e-07" iyz="0.0" izz="3.2e-07"/>
        </inertial>
        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <cylinder radius="0.008" length="0.008"/>
            </geometry>
        </collision>
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <cylinder radius="0.008" length="0.008"/>
            </geometry>
        </visual>    
    </xacro:macro>
    <xacro:macro name="upper_leg" params="mass">
 	    <inertial>
            <origin xyz="0 0 0.03" rpy="0 0 0"/>
            <mass value="${mass}" />
            <inertia ixx="3.015625e-05" ixy="0.0" ixz="0.0" iyy="3.015625e-05" iyz="0.0" izz="3.125e-07"/>
        </inertial>
        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <cylinder length="0.06" radius="0.0025"/>
            </geometry>
        </collision>
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://my_gurdy_description/models/gurdy/meshes/gurdy_higherleg_v2.dae"/>
            </geometry>
        </visual>    
    </xacro:macro>
    <xacro:macro name="lower_leg" params="mass">
 	    <inertial>
            <origin xyz="0 0 0.03" rpy="0 0 0"/>
            <mass value="${mass}" />
            <inertia ixx="9.001875e-06" ixy="0.0" ixz="0.0" iyy="9.001875e-06" iyz="0.0" izz="1.8e-05"/>
        </inertial>
        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <cylinder radius="0.0015" length="0.06"/>
            </geometry>
        </collision>
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://my_gurdy_description/models/gurdy/meshes/gurdy_lowerleg_v2.dae"/>
            </geometry>
        </visual>    
    </xacro:macro>
    <xacro:macro name="foot" params="mass">
 	    <inertial>
            <origin xyz="0 0 0.03" rpy="0 0 0"/>
            <mass value="${mass}" />
            <inertia ixx="2.56e-07" ixy="0.0" ixz="0.0" iyy="2.56e-07" iyz="0.0" izz="2.56e-07"/>
        </inertial>
        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <sphere radius="0.008"/>
            </geometry>
        </collision>
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <sphere radius="0.008"/>
            </geometry>  
        </visual>
    </xacro:macro>
    <xacro:macro name="gaze_constants">
        <kp>1000.0</kp>
        <kd>1000.0</kd>
        <mu1>10.0</mu1>
        <mu2>10.0</mu2>
    </xacro:macro>
    <xacro:macro name="extra_transmissions" params='num'>
        <transmission name="tran${num}">
            <type>transmission_interface/SimpleTransmission</type>
            <joint name="upperleg_extra_M${num}_joint">
                <hardwareInterface>EffortJointInterface</hardwareInterface>
            </joint>
            <actuator name="motor${num}">
                <hardwareInterface>EffortJointInterface</hardwareInterface>
                <mechanicalReduction>1</mechanicalReduction>
            </actuator>
        </transmission>
    </xacro:macro>
    <xacro:macro name="upper_transmission" params='num'>
        <transmission name="tran${num}">
            <type>transmission_interface/SimpleTransmission</type>
            <joint name="head_upperlegM${num}_joint">
                <hardwareInterface>EffortJointInterface</hardwareInterface>
            </joint>
            <actuator name="motor${num}">
                <hardwareInterface>EffortJointInterface</hardwareInterface>
                <mechanicalReduction>1</mechanicalReduction>
            </actuator>
        </transmission>
    </xacro:macro>
    <xacro:macro name="lower_transmission" params='num'>
        <transmission name="tran${num}">
            <type>transmission_interface/SimpleTransmission</type>
            <joint name="upperlegM${num}_lowerlegM${num}_joint">
                <hardwareInterface>EffortJointInterface</hardwareInterface>
            </joint>
            <actuator name="motor${num}">
                <hardwareInterface>EffortJointInterface</hardwareInterface>
                <mechanicalReduction>1</mechanicalReduction>
            </actuator>
        </transmission>
    </xacro:macro>

    <gazebo>
        <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
            <robotNamespace>/gurdy</robotNamespace>
        </plugin>
    </gazebo>

    <material name="red">
        <color rgba="0.8 0 0 1"/>
    </material>
    <material name="orange">
        <color rgba="1 0.6 0 1"/>
    </material>
    <material name="blue">
        <color rgba="0 0 1 0.5"/>
    </material>
    <material name="gray">
        <color rgba="0.75 0.75 0.75 0.5"/>
    </material>
    <material name="yellow">
        <color rgba="1 1 0 0.5"/>
    </material>
    <material name="purple">
        <color rgba="0.6 0.6 0 0.8"/>
    </material>

    <link name="base_link">
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <box size="0.01 0.01 0.01"/>
            </geometry>
            <material name="gray"/>
        </visual>     
    </link>

    <gazebo>
        <plugin name="gazebo_ros_imu_controller" filename="libgazebo_ros_imu.so">
            <robotNamespace>/gurdy</robotNamespace>
            <topicName>imu/data</topicName>
      `     <serviceName>imu/service</serviceName>
            <bodyName>base_link</bodyName>
            <gaussianNoise>0</gaussianNoise>
            <rpyOffsets>0 0 0</rpyOffsets>
            <updateRate>10.0</updateRate>
            <alwaysOn>true</alwaysOn>
            <gaussianNoise>0</gaussianNoise>
        </plugin>
    </gazebo> 

    <gazebo reference="base_link">
        <xacro:gaze_constants />
        <material>Gazebo/Black</material>
    </gazebo>

    <link name="head_link">
         <inertial>
            <xacro:default_origin />
            <mass value="0.01" />
            <inertia ixx="7.58333333333e-06" ixy="0.0" ixz="0.0" iyy="7.58333333333e-06" iyz="0.0" izz="1.25e-05"/>
        </inertial>

        <collision>
            <xacro:default_origin />
            <geometry>
                <cylinder radius="0.05" length="0.04"/>
            </geometry>
        </collision>
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://my_gurdy_description/models/gurdy/meshes/gurdy_head_v2.dae"/>
            </geometry>
            <material name="gray"/>
        </visual>
    </link>

    <joint name="base_head_joint" type="fixed">
        <parent link="base_link"/>
        <child link="head_link"/>
        <origin xyz="0 0 0" rpy="0 -0 0"/>
    </joint>

    <link name="upper_leg_extra_M1_link">
        <xacro:upper_extra mass="0.01"/>
    </link>

    <gazebo reference="upper_leg_extra_M1_link">
        <xacro:gaze_constants />
        <material>Gazebo/Red</material>
    </gazebo>

    <joint name="upperleg_extra_M1_joint" type="revolute">
        <parent link="head_link"/>
        <child link="upper_leg_extra_M1_link"/>
        <origin xyz="-0.02165 -0.0125 -0.008" rpy="0 0 0"/>
        <limit lower="-0.6" upper="0.6" effort="1" velocity="0.005"/>
        <axis xyz="0 0 1"/>
    </joint>

    <xacro:extra_transmissions num="7"/>

    <link name="upper_leg_M1_link">
        <xacro:upper_leg mass="0.01"/>
        <material name="red"/>
    </link>

    <gazebo reference="upper_leg_M1_link">
        <xacro:gaze_constants />
        <material>Gazebo/Red</material>
    </gazebo>
    
    <joint name="head_upperlegM1_joint" type="revolute">
        <parent link="upper_leg_extra_M1_link"/>
        <child link="upper_leg_M1_link"/>
        <origin xyz="0 0 0" rpy="3.14159 0 0.523599"/>
        <limit lower="-1.5" upper="0" effort="1" velocity="0.005"/>
        <axis xyz="0 1 0"/>
    </joint>

    <xacro:upper_transmission num="1"/>

    <link name="upper_leg_extra_M2_link">
        <xacro:upper_extra mass="0.01"/>
    </link>

    <gazebo reference="upper_leg_extra_M2_link">
        <xacro:gaze_constants />
        <material>Gazebo/Blue</material>
    </gazebo>

    <joint name="upper_leg_extra_M2_joint" type="revolute">
        <parent link="head_link"/>
        <child link="upper_leg_extra_M2_link"/>
        <origin xyz="0.02165 -0.0125 -0.008" rpy="0 0 0 "/>
        <limit lower="-0.7" upper="0.7" effort="1" velocity="0.005"/>
        <axis xyz="0 0 1"/>
    </joint>

    <xacro:extra_transmissions num="8"/>

    <link name="upper_leg_M2_link">
        <xacro:upper_leg mass="0.01"/>
        <material name="yellow"/>
    </link>

    <gazebo reference="upper_leg_M2_link">
        <xacro:gaze_constants />
        <material>Gazebo/Black</material>
    </gazebo>

    <joint name="head_upperlegM2_joint" type="revolute">
        <parent link="upper_leg_extra_M2_link"/>
        <child link="upper_leg_M2_link"/>
        <origin xyz="0 0 0" rpy="3.14159 0 2.61799"/>
        <limit lower="-1.5" upper="0" effort="1" velocity="0.005"/>
        <axis xyz="0 1 0"/>
    </joint>

    <xacro:upper_transmission num="2"/>

    <link name="upper_leg_extra_M3_link">
        <xacro:upper_extra mass="0.01"/>
    </link>

    <gazebo reference="upper_leg_extra_M3_link">
        <xacro:gaze_constants />
        <material>Gazebo/White</material>
    </gazebo>

    <joint name="upperleg_extra_M3_joint" type="revolute">
        <parent link="head_link"/>
        <child link="upper_leg_extra_M3_link"/>
        <origin xyz="0 0.025 -0.008" rpy="0 0 0"/>
        <limit lower="-0.7" upper="0.7" effort="1" velocity="0.005"/>
        <axis xyz="0 0 1"/>
    </joint>

    <xacro:extra_transmissions num="9"/>

    <link name="upper_leg_M3_link">
        <xacro:upper_leg mass="0.01"/>
        <material name="orange"/>
    </link>

    <gazebo reference="upper_leg_M3_link">
        <xacro:gaze_constants />
        <material>Gazebo/Blue</material>
    </gazebo>

    <joint name="head_upperlegM3_joint" type="revolute">
        <parent link="upper_leg_extra_M3_link"/>
        <child link="upper_leg_M3_link"/>
        <origin xyz="0 0 0" rpy="3.14159 0 -1.5708"/>
        <limit lower="-1.5" upper="0" effort="1" velocity="0.005"/>
        <axis xyz="0 1 0"/>
    </joint>

    <xacro:upper_transmission num="3"/>

    <link name="lowerleg_M1_link">
        <xacro:lower_leg mass="0.01"/>
    </link>

    <gazebo reference="lowerleg_M1_link">
        <xacro:gaze_constants />
        <material>Gazebo/Green</material>
    </gazebo>

    <joint name="upperlegM1_lowerlegM1_joint" type="continuous">
        <parent link="upper_leg_M1_link"/>
        <child link="lowerleg_M1_link"/>
        <origin xyz="0 0.0095 0.06" rpy="0 -0 3.14159"/>
        <limit lower="-2.9" upper="1.5708" effort="1.0" velocity="0.005"/>
        <axis xyz="0 1 0"/>
    </joint>

    <xacro:lower_transmission num="4"/>

    <link name="lowerleg_M2_link">
        <xacro:lower_leg mass="0.01"/>
    </link>

    <gazebo reference="lowerleg_M2_link">
        <xacro:gaze_constants />
        <material>Gazebo/Green</material>
    </gazebo>

    <joint name="upperlegM2_lowerlegM2_joint" type="revolute">
        <parent link="upper_leg_M2_link"/>
        <child link="lowerleg_M2_link"/>
        <origin xyz="0 0.0095 0.06" rpy="0 -0 3.14159"/>
        <limit lower="-2.9" upper="1.5708" effort="1.0" velocity="0.005"/>
        <axis xyz="0 1 0"/>
    </joint>
    
    <xacro:lower_transmission num="5"/>

    <link name="lowerleg_M3_link">
        <xacro:lower_leg mass="0.01"/>
    </link>

    <gazebo reference="lowerleg_M3_link">
        <kp>1000.0</kp>
        <kd>1000.0</kd>
        <mu1>10.0</mu1>
        <mu2>10.0</mu2>
        <material>Gazebo/Orange</material>
    </gazebo>

    <joint name="upperlegM3_lowerlegM3_joint" type="continuous">
        <parent link="upper_leg_M3_link"/>
        <child link="lowerleg_M3_link"/>
        <origin xyz="0 0.0095 0.06" rpy="0 -0 3.14159"/>
        <limit lower="-2.9" upper="1.5708" effort="1.0" velocity="0.005"/>
        <axis xyz="0 1 0"/>
    </joint>

    <xacro:lower_transmission num="6"/>

    <link name="foot_M1_link">
        <xacro:foot mass="0.01"/>
    </link>

    <gazebo reference="foot_M1_link">
        <xacro:gaze_constants />
        <material>Gazebo/Red</material>
    </gazebo>

    <joint name="basefoot_peg_M1_lowerleg_M1_joint" type="prismatic">
        <parent link="lowerleg_M1_link"/>
        <child link="foot_M1_link"/>
        <origin xyz="0 0 0.06" rpy="0 -0 0"/>
        <limit lower="0.0" upper="0.05" effort="100000.0" velocity="50.0"/>
    </joint>

    <link name="foot_M2_link">
        <xacro:foot mass="0.01"/>
    </link> 

    <gazebo reference="foot_M2_link">
        <xacro:gaze_constants />
        <material>Gazebo/Green</material>
    </gazebo>

    <joint name="basefoot_peg_M2_lowerleg_M2_joint" type="prismatic">
        <parent link="lowerleg_M2_link"/>
        <child link="foot_M2_link"/>
        <origin xyz="0 0 0.06" rpy="0 -0 0"/>
        <limit lower="0.0" upper="0.05" effort="100000.0" velocity="50.0"/>
    </joint>
    
    <link name="foot_M3_link">
        <xacro:foot mass="0.01"/>
    </link> 

    <gazebo reference="foot_M3_link">
        <xacro:gaze_constants />
        <material>Gazebo/Green</material>
    </gazebo>

    <joint name="basefoot_peg_M3_lowerleg_M3_joint" type="prismatic">
        <parent link="lowerleg_M3_link"/>
        <child link="foot_M3_link"/>
        <origin xyz="0 0 0.06" rpy="0 -0 0"/>
        <limit lower="0.0" upper="0.05" effort="100000.0" velocity="50.0"/>
    </joint>

    <link name="extra_arm_link">
 	    <inertial>
            <origin rpy="0.0 0 0" xyz="0 0 0"/>
            <mass value="0.01" />
            <inertia ixx="3.015625e-06" ixy="0.0" ixz="0.0" iyy="3.015625e-06" iyz="0.0" izz="3.125e-08"/>
        </inertial>
        <collision>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                 <mesh filename="package://my_gurdy_description/models/gurdy/meshes/gurdy_higherleg_v2.dae"/>
            </geometry>
        </collision>
        <visual>
            <origin rpy="0.0 0 0" xyz="0 0 0"/>
            <geometry>
                 <mesh filename="package://my_gurdy_description/models/gurdy/meshes/gurdy_higherleg_v2.dae"/>
            </geometry>
        </visual>
	</link>

    <gazebo reference="extra_arm_link">
        <xacro:gaze_constants />
        <material>Gazebo/Orange</material>
    </gazebo>

    <joint name="head_arm_joint" type="revolute">
    	<parent link="head_link"/>
    	<child link="extra_arm_link"/>
        <origin xyz="-0 0 0.0" rpy="0 0 0"/>
        <limit lower="-0.7" upper="0.7" effort="1.0" velocity="0.005"/>
        <axis xyz="0 0 1"/>
	</joint>

    <transmission name="tran10">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="head_arm_joint">
            <hardwareInterface>EffortJointInterface</hardwareInterface>
        </joint>
        <actuator name="motor_ex4">
            <hardwareInterface>EffortJointInterface</hardwareInterface>
            <mechanicalReduction>1</mechanicalReduction>
        </actuator>
    </transmission>

    <link name="camera_holder_link">
 	    <inertial>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <mass value="0.01" />
            <inertia ixx="2.56e-07" ixy="0.0" ixz="0.0" iyy="2.56e-07" iyz="0.0" izz="2.56e-07"/>
        </inertial>
        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <sphere radius="0.008"/>
            </geometry>
        </collision>
        <visual>
            <origin rpy="0.0 0 0" xyz="0 0 0"/>
            <geometry>
                <sphere radius="0.008"/>
            </geometry>
        </visual>
	</link>

    <gazebo reference="camera_holder_link">
        <xacro:gaze_constants />
        <material>Gazebo/Yellow</material>
    </gazebo>


    <joint name="camera_holder_joint" type="fixed">
        <parent link="extra_arm_link"/>
        <child link="camera_holder_link"/>
        <origin xyz="0 0 0.06" rpy="0 0 0"/>
    </joint>

    <link name="camera_link">
        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <mass value="0.001" />
            <inertia ixx="9.1875e-09" ixy="0.0" ixz="0.0" iyy="9.1875e-09" iyz="0.0" izz="1.378125e-08"/>
        </inertial>
		<visual>
            <origin rpy="0.0 0 0" xyz="0 0 0"/>
            <geometry>
                <box size="0.005 0.005 0.005"/>
            </geometry>
            <material name="blue"/>
        </visual>

	</link>

    <gazebo reference="camera_link">
        <xacro:gaze_constants />
        <material>Gazebo/Blue</material>
    </gazebo>

    <joint name="camera_joint" type="fixed">
        <parent link="camera_holder_link"/>
        <child link="camera_link"/>
        <origin xyz="0 0.0002 0.0045" rpy="0 0 0"/>
    </joint>

    <gazebo reference="camera_link">
        <sensor type="camera" name="camera1">
        <update_rate>15.0</update_rate>
        <camera name="head">

            <pose>0 0 0 0 0 1.57</pose>

            <horizontal_fov>1.3962634</horizontal_fov>
            <image>
            <width>400</width>
            <height>400</height>
            <format>R8G8B8</format>
            </image>
            <clip>
            <near>0.01</near>
            <far>100</far>
            </clip>
            <noise>
            <type>gaussian</type>
            <stddev>0.007</stddev>
            </noise>
        </camera>
        <plugin name="camera_controller" filename="libgazebo_ros_camera.so">
            <alwaysOn>true</alwaysOn>
            <updateRate>0.0</updateRate>
            <cameraName>gurdy/camera1</cameraName>
            <imageTopicName>image_raw</imageTopicName>
            <cameraInfoTopicName>camera_info</cameraInfoTopicName>
            <frameName>camera_link</frameName>
            <hackBaseline>0.07</hackBaseline>
            <distortionK1>0.0</distortionK1>
            <distortionK2>0.0</distortionK2>
            <distortionK3>0.0</distortionK3>
            <distortionT1>0.0</distortionT1>
            <distortionT2>0.0</distortionT2>
        </plugin>
        </sensor>
    </gazebo>

</robot>
   